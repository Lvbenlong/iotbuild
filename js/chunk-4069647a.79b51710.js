(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4069647a"],{1750:function(t,e,a){},"2c77":function(t,e,a){"use strict";a.d(e,"c",function(){return r}),a.d(e,"b",function(){return s}),a.d(e,"a",function(){return c}),a.d(e,"d",function(){return o});var n=a("8897"),i=a("751a");function r(t){return i["a"].get("".concat(n["a"].baseUrl,"/v2/alarms/").concat(t.notice_status),t)}function s(t){return i["a"].get("".concat(n["a"].baseUrl,"/v3/place/").concat(t))}function c(t,e,a,r,s,c){var o="".concat(n["a"].baseUrl,"/v2/alarms/excel?start=").concat(t,"&end=").concat(e);return a>=0&&(o+="&place_id=".concat(a)),s>=0&&(o+="&alarm_type=".concat(s)),c>=0&&(o+="&status=".concat(c)),i["a"].download(o,r)}function o(t){return i["a"].get("".concat(n["a"].baseUrl,"/v2/tasks"),t)}},"4ba2":function(t,e,a){"use strict";var n=a("1750"),i=a.n(n);i.a},"532c":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"malfunction"},[a("title-header",{attrs:{title:"隐患通知单"}}),a("div",{staticClass:"selects"},[a("div",{staticClass:"select-titles"},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"common-item"},[t._v("开始时间")])]),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"common-item"},[t._v("结束时间")])]),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"common-item"})])],1)],1),a("div",{staticClass:"select-content"},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:8}},[a("div",{staticClass:"common-item selsct-common"},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择"},model:{value:t.queryFilter.startTime,callback:function(e){t.$set(t.queryFilter,"startTime",e)},expression:"queryFilter.startTime"}})],1)]),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"common-item selsct-common"},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"请选择"},model:{value:t.queryFilter.endTime,callback:function(e){t.$set(t.queryFilter,"endTime",e)},expression:"queryFilter.endTime"}})],1)]),a("el-col",{attrs:{span:8}},[a("el-button",{staticClass:"green",attrs:{type:"primary"},on:{click:t.handleSearch}},[t._v("查询")])],1)],1)],1)]),a("div",{staticClass:"tool"},[a("el-button",{staticClass:"opacity",class:{green:0===t.noticestatus},attrs:{type:"primary"},on:{click:function(e){return t.changenoticestatus(0)}}},[t._v("未读")]),a("el-button",{staticClass:"opacity",class:{green:1===t.noticestatus},attrs:{type:"primary"},on:{click:function(e){return t.changenoticestatus(1)}}},[t._v("已读")]),a("el-button",{staticClass:"opacity",class:{green:2===t.noticestatus},attrs:{type:"primary"},on:{click:function(e){return t.changenoticestatus(2)}}},[t._v("全部")])],1),a("div",{staticClass:"data"},[a("iot-table",{attrs:{tableHeader:t.tableHeader,tableData:t.tableData,pagination:t.pagination,loading:t.loading},on:{reloaddata:t.initData},scopedSlots:t._u([{key:"col-user_name",fn:function(e){return a("div",{},[a("p",[t._v(t._s(e.row.user_name)+" "+t._s(e.row.user_phone))])])}},{key:"col-alarm_type",fn:function(e){return a("div",{},[a("p",[t._v(t._s(t.alarmType(e.row.alarm_type)))])])}},{key:"col-notice",fn:function(e){return a("div",{},[a("p",[t._v(t._s(t.noticeTime(e.row.notice)))])])}},{key:"col-confirm",fn:function(e){return a("div",{},[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.handleClick(e.row)}}},[t._v("隐患通知单")])],1)}}])})],1),a("alarm-notice",{ref:"alarmNotice",on:{"export-success":t.initData}})],1)},i=[],r=(a("96cf"),a("3b8d")),s=a("8897"),c=a("2c77"),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:t.showStatus,expression:"showStatus"}],attrs:{id:"alarm_notice_container"}},[a("div",{staticClass:"popup yh-detail",attrs:{id:"alarm_notice"}},[a("div",{staticStyle:{background:"#ffffff"}},[a("h1",{staticStyle:{color:"red","font-size":"24px"},attrs:{align:"center"}},[t._v("安全隐患通知单")]),a("h4",{attrs:{align:"center"}},[t._v("["+t._s(t.pdfData.year)+"] 编号 "+t._s(t.pdfData.number))]),a("hr",{attrs:{align:"center",color:"red",size:"2"}}),a("table",{attrs:{width:"100%"}},[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("至 ："+t._s(t.pdfData.place_name))]),a("td",{staticStyle:{"text-align":"right"}},[t._v(t._s(t.pdfData.file_time))])])]),a("p",{staticStyle:{"text-indent":"2em"}},[t._v("系统发现有告警长时间未有效处理，系统记录如下：")]),a("p",{staticStyle:{"text-indent":"2em"}},[t._v("隐患设备："+t._s(t.pdfData.alarm_mac))]),a("p",{staticStyle:{"text-indent":"2em"}},[t._v("隐患位置："+t._s(t.pdfData.street))]),a("p",{staticStyle:{"text-indent":"2em"}},[t._v("场所监管人："+t._s(t.pdfData.supurvisor_list))]),a("table",{staticClass:" text-center",staticStyle:{"text-indent":"2em"},attrs:{align:"center",width:"100%",cellspacing:"15px"}},[t._m(0),t._l(t.pdfData.notice_time,function(e,n){return a("tr",{key:n},[a("td",{staticClass:"text-center",attrs:{height:"25px",align:"center"}},[t._v(t._s(t.pdfData.user_name))]),a("td",{staticClass:"text-center",attrs:{height:"25px",align:"center"}},[t._v(t._s(t.pdfData.alarm_name))]),a("td",{staticClass:"text-center",attrs:{height:"25px",align:"center"}},[t._v(t._s(e))])])})],2),a("p",{staticStyle:{"text-indent":"2em"}},[t._v("为避免发生损失，【"+t._s(t.pdfData.province)+"】特向您处发出火灾预警通知单，请及时消除安全隐患。")]),a("img",{staticClass:"stamp",attrs:{src:this.pdfData.stamp_url}}),a("table",{attrs:{width:"100%"}},[a("tr",[a("td",{staticStyle:{"text-align":"right"}},[t._v("（"+t._s(t.pdfData.province)+"）科技有限公司")])]),t._m(1)])]),a("button",{directives:[{name:"auth",rawName:"v-auth",value:"NOTICE_E",expression:"'NOTICE_E'"}],staticClass:"btn btn-middle",attrs:{id:"btn-export"},on:{click:t.exportPDF}},[t._v("导出")]),a("span",{staticClass:"layui-layer-setwin",attrs:{id:"btn-close"}},[a("a",{staticClass:"close-popup layui-layer-close layui-layer-close1",attrs:{href:"javascript:;"},on:{click:t.cancel}},[a("span",{staticClass:"iconfont iconguanbi close-iconfont gray"})])])])])},l=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",[a("th",{staticClass:"text-center",staticStyle:{"font-weight":"bold"},attrs:{height:"25px",align:"center"}},[t._v("设备监管人")]),a("th",{staticClass:"text-center",staticStyle:{"font-weight":"bold"},attrs:{height:"25px",align:"center"}},[t._v("报警类型")]),a("th",{staticClass:"text-center",staticStyle:{"font-weight":"bold"},attrs:{height:"25px",align:"center"}},[t._v("时间")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",[a("td",{staticStyle:{"text-align":"right"}})])}],d=(a("7f7f"),a("a481"),a("751a"));function u(t){return d["a"].get("".concat(s["a"].baseUrl,"/v2/download"),t)}function p(t){return d["a"].postWithJson("".concat(s["a"].baseUrl,"/v2/notice"),t)}function m(t){return d["a"].get("".concat(s["a"].baseUrl,"/v3/company"),t)}var f=a("3389"),h=a("c70b"),g={data:function(){return{showStatus:!1,info:{fileNumber:"",sendTime:"",alarmType:"",address:"",deviceType:"",alarmTime:"",sendOrderTime:"",sendOrderUser:"",receiveOrderUser:"",receiveOrderUserPhone:"",handleTime:"",memo:"",projectName:"",admin:"",company:"",alarmId:""},wmk:"",companyTitle:"",seal:"",originData:{},html:null,pdfData:{}}},methods:{show:function(t){var e=this,a=t.raw_info.timestamp;a=a.substring(0,19),a=a.replace(/-/g,"/");var n=new Date(a).getTime()/1e3;u({alarm_mac:t.raw_info.mac,alarm_type:t.alarm_type,user_name:t.user_name,place_id:t.place_id,dc_time:n}).then(function(t){e.html=t.img_file,e.pdfData=t.data},function(t){f["a"].error("获取失败",f["a"].findErrorMsg(t))}),this.showStatus=!0},findCompany:function(t){var e=this;m(t).then(function(t){var a=t.data.custom_dict;e.companyTitle=a?a.NotifyComTitle:t.data.name,e.wmk=a?a.NotfiyFootprint:"",e.seal=a?s["a"].qiniu_occc_url+a.NotifyStamp:""},function(t){f["a"].error("获取系统用户失败",f["a"].findErrorMsg(t))})},queryExportTime:function(){var t=this;return p({alarm_id:this.info.alarmId}).then(function(e){return t.info.sendTime=h["a"].format(new Date(1e3*e.data),"YYYY-MM-dd"),t.originData.notice={create_time:e.data},e.data},function(t){f["a"].error("导出失败",f["a"].findErrorMsg(t))})},generatePDF:function(t){var e=this;document.getElementById("alarm_notice").style.borderRadius="0",document.getElementById("btn-export").style.display="none",document.getElementById("btn-close").style.display="none",html2canvas(document.getElementById("alarm_notice"),{useCORS:!0}).then(function(a){var n=a.width,i=a.height,r=n/595.28*841.89,s=i;document.getElementById("alarm_notice").style.background="#fff";var c=a.toDataURL("image/png"),o=new jsPDF({background:"#fff"});if(e.wmk&&e.addWatermark(o,e.wmk),s<r)o.addImage(c,"png",15,0);else while(s>0)o.addImage(c,"png",15,0),s-=r,s>0&&o.addImage(c,"png",15,0);o.save("安全隐患通知单.pdf"),document.getElementById("alarm_notice").style.borderRadius="6px",document.getElementById("btn-export").style.display="inline-block",document.getElementById("btn-close").style.display="inline-block",t&&e.$emit("export-success")})},addWatermark:function(t,e){A4[841.89];var a=document.createElement("canvas");a.style.width="200px",a.style.height="200px";var n=a.getContext("2d");n.font="italic small-caps bold 16px Verdana",n.fillStyle="#cfd8dc",n.rotate(-Math.PI/6),n.fillText(e,25,180);var i=a.toDataURL("image/png"),r=150,s=260,c=5,o=0;do{t.addImage(i,"png",c,o),c+=50,c>r&&(c=5,o+=50)}while(o<s)},exportPDF:function(){this.generatePDF(!0)},cancel:function(){this.showStatus=!1},queryProject:function(t){var e=this;Object(c["b"])(t).then(function(t){e.info.projectName=t.data.place.name,e.info.company=t.data.place.company,e.info.admin=t.data.supervisors.map(function(t){return t.name}).join("、")},function(t){f["a"].error("加载项目数据失败",f["a"].findErrorMsg(t))})}}},_=g,y=(a("676f"),a("2877")),v=Object(y["a"])(_,o,l,!1,null,null,null),b=v.exports,w=a("5568"),x=a("dab0"),C={name:"Malfunction",components:{alarmNotice:b,iotTable:w["a"],TitleHeader:x["a"]},mounted:function(){this.initData()},data:function(){return{loading:!1,queryFilter:{startTime:new Date(Date.now()-6048e5),endTime:new Date},project:{name:"",id:""},noticestatus:0,status:0,tableData:[],pagination:{page:1,per_page:10,total:0},tableHeader:[{prop:"address",label:"安装位置"},{prop:"raw_info.timestamp",label:"报警时间"},{prop:"user_name",label:"监管人",type:"slot"},{prop:"place_name",label:"所属项目"},{prop:"alarm_type",label:"事件类型",type:"slot"},{prop:"raw_info.mac",label:"设备mac"},{prop:"notice",label:"通知时间",type:"slot"},{prop:"confirm",label:"操作",type:"slot"}]}},computed:{alarmType:function(){return function(t){return s["a"].alarmTypes[t]}},noticeTime:function(){return function(t){var e=(t||{}).create_time;return e?h["a"].format(new Date(1e3*e),"YYYY-MM-dd HH:mm:ss"):""}}},methods:{changenoticestatus:function(t){this.noticestatus=t||0,this.status=0,this.initData()},handleClick:function(t){this.$refs.alarmNotice.show(t)},initData:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,a,n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loading=!0,e={page:this.pagination.page,per_page:this.pagination.per_page,start:this.queryFilter.startTime?Math.ceil(this.queryFilter.startTime.getTime()/1e3):"",end:this.queryFilter.endTime?Math.ceil(this.queryFilter.endTime.getTime()/1e3):"",place_id:this.queryFilter.project?(this.queryFilter.project.item||this.queryFilter.project).id:void 0,notice_status:this.noticestatus},t.prev=2,t.next=5,Object(c["c"])(e);case 5:a=t.sent,n=a.data,this.tableData=n.items,this.pagination={total:n.page_info.total,page:n.page_info.page,per_page:n.page_info.per_page},this.loading=!1,t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](2),this.loading=!1,f["a"].error("查询数据失败");case 16:case"end":return t.stop()}},t,this,[[2,12]])}));function e(){return t.apply(this,arguments)}return e}(),handleSearch:function(){""===this.queryFilter.startTime&&""===this.queryFilter.endTime?f["a"].error("查询条件不能为空"):this.initData()}}},D=C,T=(a("cb21"),Object(y["a"])(D,n,i,!1,null,null,null));e["default"]=T.exports},5568:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"iotTable"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData}},t._l(t.tableHeader,function(e,n){return"slot"!==e.type?a("el-table-column",{key:n,attrs:{prop:e.prop,width:e.width,label:e.label}}):a("el-table-column",{key:n,attrs:{width:e.width||150,label:e.label},scopedSlots:t._u([{key:"default",fn:function(a){return[t._t("col-"+e.prop,null,{row:a.row,index:a.$index})]}}],null,!0)})}),1),t.hidepagination?t._e():a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":t.pagination.page,"page-sizes":[10,20,50,100],"page-size":t.pagination.per_page,layout:"total, sizes, prev, pager, next, jumper",total:t.pagination.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},i=[],r={name:"IotTable",props:{tableData:{type:Array,required:!0},tableHeader:{type:Array,required:!0},loading:{type:Boolean},pagination:{type:Object,required:!0},hidepagination:{type:Boolean,default:!1}},data:function(){return{}},methods:{handleSizeChange:function(t){this.pagination.per_page=t,this.$emit("reloaddata")},handleCurrentChange:function(t){console.log(t),this.pagination.page=t,this.$emit("reloaddata")}}},s=r,c=(a("e927"),a("2877")),o=Object(c["a"])(s,n,i,!1,null,"2e99ce96",null);e["a"]=o.exports},"676f":function(t,e,a){"use strict";var n=a("bf3b"),i=a.n(n);i.a},b6ee:function(t,e,a){},bf3b:function(t,e,a){},cb21:function(t,e,a){"use strict";var n=a("d7e4"),i=a.n(n);i.a},d7e4:function(t,e,a){},dab0:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"titleHeader"},[a("h3",[t._v(t._s(t.title))])])},i=[],r={name:"TitleHeader",props:["title"],data:function(){return{}}},s=r,c=(a("4ba2"),a("2877")),o=Object(c["a"])(s,n,i,!1,null,"410d105d",null);e["a"]=o.exports},e927:function(t,e,a){"use strict";var n=a("b6ee"),i=a.n(n);i.a}}]);
//# sourceMappingURL=chunk-4069647a.79b51710.js.map